# –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ 1–°

## üìã –û–±–∑–æ—Ä

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ 1–° —á–µ—Ä–µ–∑ OData –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ UI –∏ –∑–∞–Ω–∏–º–∞–ª–∞ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è) —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.

---

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
- ‚ùå –ú–æ–¥–∞–ª–∫–∞ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚ùå –î–æ–ª–≥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ (–º–∏–Ω—É—Ç—ã) –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (non-blocking)
- ‚úÖ –ú–æ–¥–∞–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ Polling –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Backend (FastAPI)

#### 1. Endpoint –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**POST** `/api/v1/bank-transactions/odata/sync`

**–î–æ:**
```python
# –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ - –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å
result = sync_service.sync_transactions(...)
return result  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–∏–Ω—É—Ç—ã)
```

**–ü–æ—Å–ª–µ:**
```python
# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ BackgroundTasks
background_tasks.add_task(run_sync_task)

# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É —Å task_id
return {
    'task_id': 'uuid-string',
    'message': '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ',
    'status': 'STARTED'
}
```

**Response (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç):**
```json
{
  "task_id": "a1b2c3d4-5678-90ab-cdef-1234567890ab",
  "message": "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –¥–ª—è –æ—Ç–¥–µ–ª–∞ \"–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç–¥–µ–ª\"",
  "status": "STARTED",
  "department": {
    "id": 1,
    "name": "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç–¥–µ–ª"
  }
}
```

#### 2. Endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

**GET** `/api/v1/bank-transactions/odata/sync/status/{task_id}`

**Response (–ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏):**
```json
{
  "task_id": "a1b2c3d4-5678-90ab-cdef-1234567890ab",
  "status": "STARTED",
  "started_at": "2025-11-17T15:30:00",
  "department_id": 1,
  "user_id": 5
}
```

**Response (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è):**
```json
{
  "task_id": "a1b2c3d4-5678-90ab-cdef-1234567890ab",
  "status": "COMPLETED",
  "started_at": "2025-11-17T15:30:00",
  "completed_at": "2025-11-17T15:32:15",
  "result": {
    "total_fetched": 150,
    "created": 120,
    "updated": 28,
    "skipped": 2,
    "auto_categorized": 95
  }
}
```

**Response (–ø—Ä–∏ –æ—à–∏–±–∫–µ):**
```json
{
  "task_id": "a1b2c3d4-5678-90ab-cdef-1234567890ab",
  "status": "FAILED",
  "started_at": "2025-11-17T15:30:00",
  "completed_at": "2025-11-17T15:30:45",
  "error": "Connection to 1C failed: timeout"
}
```

#### 3. Task Storage

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ó–∞–¥–∞—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (function attribute)
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è development –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

**Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
import redis

redis_client = redis.Redis(host='localhost', port=6379, db=0)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
redis_client.setex(
    f"sync_task:{task_id}",
    3600,  # TTL 1 —á–∞—Å
    json.dumps(task_info)
)

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
task_info = json.loads(redis_client.get(f"sync_task:{task_id}"))
```

---

### Frontend (React + TypeScript)

#### 1. API Client (`frontend/src/api/bankTransactions.ts`)

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

```typescript
// –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç task_id —Å—Ä–∞–∑—É)
syncFromOData: async (params) => Promise<{
  task_id: string
  message: string
  status: string
  department: { id: number; name: string }
}>

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
getSyncStatus: async (taskId: string) => Promise<{
  task_id: string
  status: 'STARTED' | 'COMPLETED' | 'FAILED'
  started_at: string
  completed_at?: string
  result?: {
    total_fetched: number
    created: number
    updated: number
    skipped: number
    auto_categorized: number
  }
  error?: string
}>
```

#### 2. Mutation —Å Polling (`BankTransactionsPage.tsx`)

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

```typescript
odataSyncMutation.mutate(params, {
  onSuccess: (result) => {
    // 1. –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Å—Ä–∞–∑—É
    message.success(result.message)
    setOdataSyncModalOpen(false)

    // 2. –ó–∞–ø—É—Å–∫–∞–µ–º polling
    const taskId = result.task_id
    const pollStatus = async () => {
      const status = await bankTransactionsApi.getSyncStatus(taskId)

      if (status.status === 'COMPLETED') {
        // ‚úÖ –£—Å–ø–µ—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        message.success(
          `‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: —Å–æ–∑–¥–∞–Ω–æ ${result.created}, –æ–±–Ω–æ–≤–ª–µ–Ω–æ ${result.updated}`
        )
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        queryClient.invalidateQueries(['bankTransactions'])
      } else if (status.status === 'FAILED') {
        // ‚ùå –û—à–∏–±–∫–∞
        message.error(`‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å: ${status.error}`)
      } else if (status.status === 'STARTED') {
        // ‚è≥ –ï—â–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫
        setTimeout(pollStatus, 5000)
      }
    }

    // –ù–∞—á–∞—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(pollStatus, 3000)
  }
})
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã polling:**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: **5 —Å–µ–∫—É–Ω–¥**
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: **60** (5 –º–∏–Ω—É—Ç total)
- –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —á–µ—Ä–µ–∑ **3 —Å–µ–∫—É–Ω–¥—ã** –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

---

## üìä UX Flow (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

### 1. –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
  ‚îî‚îÄ –ù–∞–∂–∏–º–∞–µ—Ç "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å 1–°"
  ‚îî‚îÄ –í—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–∏–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 01.11.2025 - 30.11.2025)
  ‚îî‚îÄ –ù–∞–∂–∏–º–∞–µ—Ç "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å"

–°–∏—Å—Ç–µ–º–∞:
  ‚îî‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –¥–ª—è –æ—Ç–¥–µ–ª–∞ \"–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç–¥–µ–ª\""
  ‚îî‚îÄ –ú–æ–¥–∞–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚úÖ
  ‚îî‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚úÖ
```

### 2. –í–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
  ‚îî‚îÄ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–∞–±–ª–∏—Ü–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  ‚îî‚îÄ –ú–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å

–°–∏—Å—Ç–µ–º–∞ (–≤ —Ñ–æ–Ω–µ):
  ‚îî‚îÄ –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
  ‚îî‚îÄ –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏
```

### 3. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

```
–°–∏—Å—Ç–µ–º–∞:
  ‚îî‚îÄ –ß–µ—Ä–µ–∑ ~2-3 –º–∏–Ω—É—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
  ‚îî‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: —Å–æ–∑–¥–∞–Ω–æ 120, –æ–±–Ω–æ–≤–ª–µ–Ω–æ 28, –ø—Ä–æ–ø—É—â–µ–Ω–æ 2"
  ‚îî‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  ‚îî‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- UI –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- Polling –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)

### 2. UX
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π feedback
- –ù–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ß–µ—Ç–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ

### 3. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–æ –∫–æ–Ω—Ü–∞ –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–ª –±—Ä–∞—É–∑–µ—Ä
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

### 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Celery/RQ –¥–ª—è distributed tasks
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ Redis
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

---

## üîÑ Migration Guide

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–°—Ç–∞—Ä—ã–π –∫–æ–¥ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π):**
```python
result = sync_service.sync_transactions(...)
return ODataSyncResult(**result)
```

**–ù–æ–≤—ã–π –∫–æ–¥ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π):**
```python
# 1. –°–æ–∑–¥–∞—Ç—å background task
def run_sync_task():
    result = sync_service.sync_transactions(...)
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ storage

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–µ
background_tasks.add_task(run_sync_task)

# 3. –í–µ—Ä–Ω—É—Ç—å task_id —Å—Ä–∞–∑—É
return {'task_id': task_id, 'status': 'STARTED'}
```

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–ª—Å—è —Ç–µ–º –∂–µ:
- –¢–∞ –∂–µ –∫–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å 1–°"
- –¢–æ –∂–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- –¢–µ –∂–µ –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–æ–¥–∞

**–û—Ç–ª–∏—á–∏–µ:** –ú–æ–¥–∞–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–∑–∂–µ.

---

## üìà Performance Metrics

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**

| –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö | –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ) | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (—Ñ–æ–Ω–æ–≤–∞—è) |
|--------------|---------------------------|------------------------|
| 100 –∑–∞–ø–∏—Å–µ–π  | ~30 —Å–µ–∫ (UI –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω) | <1 —Å–µ–∫ (UI —Å–≤–æ–±–æ–¥–µ–Ω), sync –≤ —Ñ–æ–Ω–µ 30 —Å–µ–∫ |
| 500 –∑–∞–ø–∏—Å–µ–π  | ~2 –º–∏–Ω (UI –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)  | <1 —Å–µ–∫ (UI —Å–≤–æ–±–æ–¥–µ–Ω), sync –≤ —Ñ–æ–Ω–µ 2 –º–∏–Ω |
| 1000 –∑–∞–ø–∏—Å–µ–π | ~4 –º–∏–Ω (UI –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)  | <1 —Å–µ–∫ (UI —Å–≤–æ–±–æ–¥–µ–Ω), sync –≤ —Ñ–æ–Ω–µ 4 –º–∏–Ω |

**–í—ã–≤–æ–¥:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ UI –≤ **100 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ**.

---

## üõ†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** Polling –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª—Å—è (–ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –£–≤–µ–ª–∏—á–∏—Ç—å maxPolls –≤ BankTransactionsPage.tsx
const maxPolls = 120  // –í–º–µ—Å—Ç–æ 60 (10 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 5)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ç—É—Å "STARTED" –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ –µ—â–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–ª–∏ –∑–∞–≤–∏—Å–ª–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend
tail -f backend/logs/uvicorn.log | grep "OData sync"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/v1/bank-transactions/odata/sync/status/{task_id}
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è in-memory storage (function attribute)

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è production:**
```python
# –î–æ–±–∞–≤–∏—Ç—å TTL cleanup
import time

def cleanup_old_tasks():
    """Remove tasks older than 1 hour"""
    cutoff = time.time() - 3600
    tasks_to_remove = [
        task_id for task_id, info in sync_from_odata.tasks.items()
        if parse_datetime(info['started_at']).timestamp() < cutoff
    ]
    for task_id in tasks_to_remove:
        del sync_from_odata.tasks[task_id]
```

---

## üìù API Changes Summary

### Breaking Changes
**–ù–µ—Ç** - —Å—Ç–∞—Ä—ã–π API —Å–æ—Ö—Ä–∞–Ω–µ–Ω, –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### New Endpoints
- `POST /bank-transactions/odata/sync` - —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `task_id` –≤–º–µ—Å—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- `GET /bank-transactions/odata/sync/status/{task_id}` - –Ω–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

### Deprecated
**–ù–µ—Ç** - –≤—Å–µ —Å—Ç–∞—Ä—ã–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üîÆ Future Enhancements

### 1. WebSocket –¥–ª—è real-time updates
```typescript
// –í–º–µ—Å—Ç–æ polling –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket
const ws = new WebSocket('ws://localhost:8000/ws/sync')
ws.onmessage = (event) => {
  const status = JSON.parse(event.data)
  if (status.task_id === taskId && status.status === 'COMPLETED') {
    message.success('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞')
  }
}
```

### 2. Progress Bar
```json
{
  "status": "STARTED",
  "progress": {
    "current": 50,
    "total": 150,
    "percentage": 33
  }
}
```

### 3. Celery Integration
```python
from celery import Celery

celery_app = Celery('app', broker='redis://localhost:6379')

@celery_app.task
def sync_transactions_task(params):
    sync_service.sync_transactions(**params)
```

---

**–î–∞—Ç–∞:** 17 –Ω–æ—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0
**–ê–≤—Ç–æ—Ä:** Claude Code Assistant
