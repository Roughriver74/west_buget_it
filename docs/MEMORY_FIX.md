# –ö—Ä–∞—Ç–∫–∞—è –ø–∞–º—è—Ç–∫–∞: –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—Ç–µ—Ä–∏ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç

## üî• –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è (HTTP 504)

## üéØ –ü—Ä–∏—á–∏–Ω–∞
**OOM (Out of Memory)** - backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ (826MB)
- 4 Gunicorn workers √ó 200MB = ~1GB –ø–∞–º—è—Ç–∏
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ 5.8GB RAM, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —É–∂–µ –∑–∞–Ω—è—Ç–æ ~2.7GB –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- Linux OOM killer —É–±–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ)

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:

**1. docker-compose.prod.yml**
```yaml
# –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏
deploy:
  resources:
    limits:
      memory: 512M
    reservations:
      memory: 256M

# –£–º–µ–Ω—å—à–µ–Ω—ã workers
environment:
  GUNICORN_WORKERS: 2  # –ë—ã–ª–æ: 4
  GUNICORN_MAX_REQUESTS: 1000  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç
```

**2. backend/entrypoint.sh**
```bash
--workers 2  # –ë—ã–ª–æ: 4
--max-requests 1000  # –ù–æ–≤–æ–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç workers
```

### –ö–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å:

```bash
# 1. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add docker-compose.prod.yml backend/entrypoint.sh docs/
git commit -m "fix: optimize memory usage to prevent OOM kills"
git push origin main

# 2. –î–µ–ø–ª–æ–π –≤ Coolify (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ webhook)
# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é: –Ω–∞–∂–∞—Ç—å "Redeploy" –≤ Coolify UI
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- Memory: 826MB ‚Üí ~400-500MB (—Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 50%)
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–æ—Å—Ç—É–ø–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å
./diagnose_access_loss.sh

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
./monitor_access.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OOM —Å–æ–±—ã—Ç–∏—è
ssh root@93.189.228.52 'dmesg -T | grep -i "out of memory"'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
ssh root@93.189.228.52 'docker stats --no-stream | grep backend'
```

## üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–°–º. [MEMORY_OPTIMIZATION.md](MEMORY_OPTIMIZATION.md) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–î–∞—Ç–∞:** 06.11.2025
