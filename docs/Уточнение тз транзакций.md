Техническое задание: Автоматическая загрузка и категоризация приходов/расходов из 1С

1. Цель

Автоматизировать процесс загрузки финансовых операций (приходы и расходы) из 1С в приложение, а также автоматическое определение их категории, источника и назначения, чтобы исключить ручную работу по распределению транзакций.

⸻

2. Источник данных

Данные поступают из 1С (приходы/расходы):
• Поступления денег
• Списания
• Оплаты по заказам
• Банковские операции
• Операции по кассе

⸻

3. Загрузка данных

3.1 Способы загрузки
1. Ручная загрузка из фронтенда
• Нажатие кнопки «Загрузить из 1С»
• Возможность выбрать период:
• Сегодня
• Неделя
• Месяц
• Произвольный диапазон дат
2. Автоматическая загрузка
• Запуск каждые 60 минут
• Загружаются данные только за сегодняшний день
• Это исключает дубли
• Упрощает синхронизацию

3.2 Механизм защиты от дублей

Используем уникальный индекс транзакции (например: id_1c + дата + сумма)
При попытке повторной загрузки система игнорирует записи, у которых индекс уже существует в базе.

⸻

4. Запись данных в систему

Транзакции сохраняются:
• в базе данных приложения
или
• во внутреннюю таблицу (как удобно по архитектуре)

Записываются поля:
• Дата
• Тип операции: Приход или Расход
• Сумма
• Источник: банк или касса
• Организация (если несколько юрлиц)
• Контрагент
• Назначение платежа
• Категория (см. пункт 5)
• Комментарий (опционально)

⸻

5. Автоматическое определение категорий

5.1 Логика работы

Система автоматически определяет категорию операции на основании:
1. Контрагента
• Если по контрагенту ранее были выбраны категории → вероятность использовать ту же категорию > 80%.
• Пример:
• Контрагент “Ситилинк” → раньше назначали категорию «Оборудование» → система будет автоматически присваивать её.
2. Типа операции
• Например:
• Оплата клиентом по заказу → автоматически категория «Покупатели (приход)»
• Оплата поставщику → «Поставщики (расход)»
3. Истории операций
• Если с контрагентом всегда связана одна категория — устанавливается автоматически.
• При неоднозначности можно выставлять «Предполагаемую категорию» и выделять цветом.

⸻

6. Источник операции

Система должна автоматически определять:
• Банк
• Касса
• Какая конкретно касса/счёт

Эти данные должны отображаться в интерфейсе.

⸻

7. Отображение и фильтрация

7.1 Фильтры по умолчанию

При загрузке данных отображаются:
• Все операции (приход + расход)
• За текущий день

7.2 Доступные фильтры
• Период (день, месяц, год, диапазон)
• Тип операции: приход/расход
• Источник: банк/касса
• Организация
• Контрагент
• Категория

7.3 Пересчёт итогов

После применения фильтров пересчитываются:
• Общий приход за период
• Общий расход за период

Например:
• За год: приход 2 000 000 000, расход 1 500 000 000
• После фильтра «этот месяц»: автоматически отображаются только данные месяца и новые суммы.

⸻

8. Ручная корректировка

Пользователь может вручную изменить:
• Категорию
• Комментарий
• Источник (если 1С дала ошибку)
• Контрагента (если нужно)

Эти данные сохраняются и используются для улучшения авто-категоризации.

⸻

9. Требования к интерфейсу
• Кнопка «Загрузить из 1С»
• Выбор периода
• Таблица с приходами/расходами
• Цветовое выделение:
• Расход — красный
• Приход — зелёный
• Метка «Авто» для автоматических категорий
• Уведомление «Загрузка успешна / нет новых данных / ошибка»

⸻

10. Итого

Система должна:
• Автоматически загружать операции из 1С каждые 60 минут
• Исключать дубли
• Определять категории автоматически (на основе истории и контрагентов)
• Разделять банк/кассу
• Фильтровать и пересчитывать данные
• Позволять ручное управление категориями
• Загружать данные по нажатию кнопки вручную
