# –ò–∑–º–µ–Ω–µ–Ω–∏—è: –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –∏–º–ø–æ—Ä—Ç –±—é–¥–∂–µ—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

**–î–∞—Ç–∞:** 2025-11-02
**–ê–≤—Ç–æ—Ä:** Claude Code

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –∏ –∏–º–ø–æ—Ä—Ç–∞ –ø–ª–∞–Ω–æ–≤ –∏–∑ Excel –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –±—é–¥–∂–µ—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–£—Ç–≤–µ—Ä–¥–∏—Ç—å" (APPROVE)

**Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

#### [BudgetPlanningPage.tsx](frontend/src/pages/BudgetPlanningPage.tsx)
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —Ö—É–∫ `useApproveVersion` (—Å—Ç—Ä–æ–∫–∞ 40)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –º—É—Ç–∞—Ü–∏—è `approveVersion` (—Å—Ç—Ä–æ–∫–∞ 138)
- –°–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleApproveVersion` (—Å—Ç—Ä–æ–∫–∏ 191-193)
- –ü–µ—Ä–µ–¥–∞–Ω prop `onApprove` –≤ `BudgetVersionTable` (—Å—Ç—Ä–æ–∫–∞ 384)

#### [BudgetVersionTable.tsx](frontend/src/components/budget/BudgetVersionTable.tsx)
- –î–æ–±–∞–≤–ª–µ–Ω prop `onApprove` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Å—Ç—Ä–æ–∫–∞ 30)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `canApprove` (—Å—Ç—Ä–æ–∫–∞ 68)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–£—Ç–≤–µ—Ä–¥–∏—Ç—å" —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∏ 182-194)

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ö–Ω–æ–ø–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥–ª—è –≤–µ—Ä—Å–∏–π –≤ —Å—Ç–∞—Ç—É—Å–µ `IN_REVIEW` –∏–ª–∏ `REVISION_REQUESTED`
- –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–æ–ª–µ–π `ADMIN` –∏ `MANAGER`
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –≤–µ—Ä—Å–∏—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å `APPROVED`
- –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –ø–ª–∞–Ω—É"

**Backend API** (—É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª):
```
POST /api/v1/budget/planning/versions/{version_id}/approve
POST /api/v1/budget/planning/versions/{version_id}/apply-to-plan
```

### 2. ‚úÖ –°–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞ –ø–ª–∞–Ω–æ–≤

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- [backend/scripts/import_budget_version.py](backend/scripts/import_budget_version.py) - —Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞
- [backend/scripts/IMPORT_BUDGET_README.md](backend/scripts/IMPORT_BUDGET_README.md) - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∞:**
- üìä –ò–º–ø–æ—Ä—Ç –±—é–¥–∂–µ—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –∏–∑ Excel
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ –≤–µ—Ä—Å–∏–π
- üìÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö 12 –º–µ—Å—è—Ü–µ–≤
- üí∞ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ CAPEX/OPEX
- ‚úçÔ∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è
- üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python backend/scripts/import_budget_version.py \
  xls/budget_plan_2026.xlsx \
  --year 2026 \
  --department-id 1 \
  --version-name "–ü–ª–∞–Ω 2026 v1"
```

**–§–æ—Ä–º–∞—Ç Excel —Ñ–∞–π–ª–∞:**
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–∏–ø | –Ø–Ω–≤–∞—Ä—å | –§–µ–≤—Ä–∞–ª—å | ... | –î–µ–∫–∞–±—Ä—å | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----------|-----|--------|---------|-----|---------|-------------|
| –°–µ—Ä–≤–µ—Ä–∞   | CAPEX | 100000 | 50000 | ... | 75000 | –ó–∞–∫—É–ø–∫–∞ |
| –ê—Ä–µ–Ω–¥–∞ –ü–û | OPEX | 25000 | 25000 | ... | 25000 | –õ–∏—Ü–µ–Ω–∑–∏–∏ |

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤

**[AuthContext.tsx](frontend/src/contexts/AuthContext.tsx)**
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–æ–ª–∏ `MANAGER` –∏ `USER` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `User` (—Å—Ç—Ä–æ–∫–∞ 11)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–æ–ª–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `RegisterData` (—Å—Ç—Ä–æ–∫–∞ 41)

**–ü—Ä–∏—á–∏–Ω–∞:**
- –í backend –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–æ–ª–∏: ADMIN, MANAGER, USER
- –í frontend –±—ã–ª–∏ —Ç–æ–ª—å–∫–æ: ADMIN, ACCOUNTANT, REQUESTER
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ä–æ–ª–µ–π

## Workflow –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞–Ω–æ–º:

1. **–°–æ–∑–¥–∞–Ω–∏–µ/–∏–º–ø–æ—Ä—Ç –ø–ª–∞–Ω–∞** ‚Üí —Å—Ç–∞—Ç—É—Å `DRAFT` ‚úèÔ∏è
   - –ß–µ—Ä–µ–∑ UI (—Å–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é + —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
   - –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ Excel
   - –ß–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç –≤ UI (–∫–Ω–æ–ø–∫–∞ –≤ drawer –≤–µ—Ä—Å–∏–∏)

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ** ‚Üí —Å—Ç–∞—Ç—É—Å `IN_REVIEW` üìã
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ"
   - –î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤–µ—Ä—Å–∏–π –≤ —Å—Ç–∞—Ç—É—Å–µ DRAFT

3. **–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (NEW!)** ‚Üí —Å—Ç–∞—Ç—É—Å `APPROVED` ‚úÖ
   - –ö–Ω–æ–ø–∫–∞ "–£—Ç–≤–µ—Ä–¥–∏—Ç—å" (—Ç–æ–ª—å–∫–æ ADMIN/MANAGER)
   - –î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤–µ—Ä—Å–∏–π IN_REVIEW –∏–ª–∏ REVISION_REQUESTED

4. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –ø–ª–∞–Ω—É** ‚Üí –¥–∞–Ω–Ω—ã–µ –≤ `budget_plans` üìä
   - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –ø–ª–∞–Ω—É" (—Ç–æ–ª—å–∫–æ ADMIN/MANAGER)
   - –î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è APPROVED –≤–µ—Ä—Å–∏–π
   - –ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–µ—Ä—Å–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ø–ª–∞–Ω–æ–≤

## –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

–°–∏—Å—Ç–µ–º–∞ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- ‚úÖ –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ UI
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
- ‚úÖ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±—é–¥–∂–µ—Ç–∞ (—Å—Ä–µ–¥–Ω–µ–µ, —Ä–æ—Å—Ç, –¥—Ä–∞–π–≤–µ—Ä—ã, —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å)
- ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–∏ (–±–∞–∑–æ–≤—ã–π, –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π, –ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

## API endpoints

```
# –†–∞–±–æ—Ç–∞ —Å –≤–µ—Ä—Å–∏—è–º–∏
GET    /api/v1/budget/planning/versions
GET    /api/v1/budget/planning/versions/{id}
POST   /api/v1/budget/planning/versions
PUT    /api/v1/budget/planning/versions/{id}
DELETE /api/v1/budget/planning/versions/{id}

# Workflow —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
POST   /api/v1/budget/planning/versions/{id}/submit          # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
POST   /api/v1/budget/planning/versions/{id}/approve         # ‚ú® NEW: –£—Ç–≤–µ—Ä–¥–∏—Ç—å
POST   /api/v1/budget/planning/versions/{id}/reject          # –û—Ç–∫–ª–æ–Ω–∏—Ç—å
POST   /api/v1/budget/planning/versions/{id}/request-changes # –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
POST   /api/v1/budget/planning/versions/{id}/apply-to-plan   # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –ø–ª–∞–Ω—É

# –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç
POST   /api/v1/budget/planning/versions/{id}/import          # –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ UI
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏ "–£—Ç–≤–µ—Ä–¥–∏—Ç—å"

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –±—é–¥–∂–µ—Ç–∞
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ (—Å—Ç–∞—Ç—É—Å ‚Üí IN_REVIEW)
4. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å —Ä–æ–ª—å—é ADMIN –∏–ª–∏ MANAGER
5. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–£—Ç–≤–µ—Ä–¥–∏—Ç—å" (‚úì)
6. –ù–∞–∂–º–∏—Ç–µ - –≤–µ—Ä—Å–∏—è –ø–æ–ª—É—á–∏—Ç —Å—Ç–∞—Ç—É—Å APPROVED
7. –ü–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –ø–ª–∞–Ω—É" (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ Excel

1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ Excel —Ñ–∞–π–ª —Å –Ω—É–∂–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
   ```bash
   python backend/scripts/import_budget_version.py \
     xls/plan.xlsx \
     --year 2026 \
     --department-id 1 \
     --version-name "–¢–µ—Å—Ç–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç"
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞
4. –û—Ç–∫—Ä–æ–π—Ç–µ UI ‚Üí –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞
5. –ù–∞–π–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ

## –ó–∞–º–µ—á–∞–Ω–∏—è

- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ë–î –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
- –¢–æ–ª—å–∫–æ ADMIN –∏ MANAGER –º–æ–≥—É—Ç —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –ø–ª–∞–Ω—ã
- –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä—Å–∏—é –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –ø–ª–∞–Ω—É —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ budget_plans
- –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –≤–µ—Ä—Å–∏—é —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º DRAFT

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Å–æ–≤–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
- [ ] –≠–∫—Å–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞ Excel –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—É–ª, –ª–∏–º–∏—Ç–æ–≤)
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–µ—Ä—Å–∏–π
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—é
