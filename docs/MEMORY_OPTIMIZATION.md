# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ—Ç–µ—Ä–∏ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

## üî• –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ production —Å–µ—Ä–≤–µ—Ä, —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é (HTTP 504 Gateway Timeout).

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –°–∏–º–ø—Ç–æ–º—ã
- ‚úÖ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚ùå –ß–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã
- ‚ùå HTTP 504 Gateway Timeout –Ω–∞ frontend –∏ backend
- ‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### –ü—Ä–∏—á–∏–Ω–∞: OOM (Out of Memory)

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã—è–≤–∏–ª–∞:**
- üî• **4 OOM (Out of Memory) —Å–æ–±—ã—Ç–∏—è** –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–∞—Ö
- üî• **Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 826MB –ø–∞–º—è—Ç–∏** (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —Å 5.8GB RAM)
- üî• **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É–±–∏–≤–∞—é—Ç—Å—è Linux OOM killer'–æ–º** –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ OOM —Å–æ–±—ã—Ç–∏–π
dmesg -T | grep -i "out of memory"

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
[Thu Nov  6 12:19:15 2025] Out of memory: Killed process 3920277 (gunicorn) total-vm:908936kB, anon-rss:350584kB
```

### –ü–æ—á–µ–º—É backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–∫ –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏?

**Gunicorn –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- 4 worker –ø—Ä–æ—Ü–µ—Å—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ö–∞–∂–¥—ã–π worker = –ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ~200-300MB –ø–∞–º—è—Ç–∏ –Ω–∞ worker
- **–ò—Ç–æ–≥–æ: 4 √ó 250MB = ~1GB –ø–∞–º—è—Ç–∏** —Ç–æ–ª—å–∫–æ –¥–ª—è backend!

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç:**
- Docker (350MB)
- PostgreSQL (46MB + 46MB)
- Redis (11MB + 6MB)
- Frontend (5MB)
- –î—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (~400MB)
- **–ò—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: ~2.7GB –∏–∑ 5.8GB**

–ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ backend –Ω–∞—á–∏–Ω–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—â–µ –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –ë–î, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤), –∏ —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç —Å–∏—Å—Ç–µ–º–∞ –∏—Å—á–µ—Ä–ø—ã–≤–∞–µ—Ç –ø–∞–º—è—Ç—å ‚Üí **OOM killer —É–±–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Gunicorn Workers

**–ë—ã–ª–æ:**
```bash
--workers 4  # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ!
```

**–°—Ç–∞–ª–æ:**
```bash
--workers 2  # –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è low-traffic production
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ —Å ~1GB –¥–æ ~500MB

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –†–µ—Å—Ç–∞—Ä—Ç Workers

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏:

```bash
--max-requests 1000            # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ worker –ø–æ—Å–ª–µ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤
--max-requests-jitter 50       # –°–ª—É—á–∞–π–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
```

Workers –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏.

### 3. Memory Limits –≤ Docker

–î–æ–±–∞–≤–ª–µ–Ω—ã –∂–µ—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏ –¥–ª—è backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```yaml
deploy:
  resources:
    limits:
      memory: 512M  # –ñ–µ—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ
    reservations:
      memory: 256M  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–º—è—Ç—å
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Docker –±—É–¥–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω gracefully
- OOM killer –Ω–µ —Å–º–æ–∂–µ—Ç —É–±–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ

### 4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è

**–í [docker-compose.prod.yml](../docker-compose.prod.yml):**
```yaml
environment:
  GUNICORN_WORKERS: ${GUNICORN_WORKERS:-2}
  GUNICORN_TIMEOUT: ${GUNICORN_TIMEOUT:-120}
  GUNICORN_KEEPALIVE: ${GUNICORN_KEEPALIVE:-5}
  GUNICORN_MAX_REQUESTS: ${GUNICORN_MAX_REQUESTS:-1000}
  GUNICORN_MAX_REQUESTS_JITTER: ${GUNICORN_MAX_REQUESTS_JITTER:-50}
```

**–í [backend/entrypoint.sh](../backend/entrypoint.sh):**
```bash
exec gunicorn app.main:app \
    --workers "${GUNICORN_WORKERS:-2}" \
    --worker-class uvicorn.workers.UvicornWorker \
    --max-requests "${GUNICORN_MAX_REQUESTS:-1000}" \
    --max-requests-jitter "${GUNICORN_MAX_REQUESTS_JITTER:-50}" \
    ...
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- Backend: ~826MB –ø–∞–º—è—Ç–∏ (4 workers)
- –ß–∞—Å—Ç—ã–µ OOM —Å–æ–±—ã—Ç–∏—è
- –ü–æ—Ç–µ—Ä—è –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- Backend: ~400-500MB –ø–∞–º—è—Ç–∏ (2 workers)
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ OOM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç workers –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫–∏
- Memory limits –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–≥–æ —Ä–æ—Å—Ç–∞

## üöÄ –î–µ–ø–ª–æ–π –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **Commit –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git:**
```bash
git add docker-compose.prod.yml backend/entrypoint.sh
git commit -m "fix: optimize memory usage - reduce workers and add memory limits"
git push origin main
```

2. **–î–µ–ø–ª–æ–π –≤ Docker:**
   - Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (webhook)
   - –ò–ª–∏ –≤—Ä—É—á–Ω—É—é: –Ω–∞–∂–º–∏—Ç–µ **"Redeploy"** –≤ Docker UI

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
ssh root@93.189.228.52 'docker stats --no-stream'

# Backend –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ~400-500MB –≤–º–µ—Å—Ç–æ 826MB
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –î–µ–ø–ª–æ–π

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@93.189.228.52

# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ Docker –∏–ª–∏ docker ps)
cd /path/to/project

# Pull –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# Rebuild –∏ restart —Ç–æ–ª—å–∫–æ backend
docker-compose -f docker-compose.prod.yml up -d --build --force-recreate backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs -f backend-<container-id>
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ rebuild

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ–±—Ä–∞–∑:

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@93.189.228.52

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec backend-<container-id> sh -c 'export GUNICORN_WORKERS=2'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker restart backend-<container-id>
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã

**1. –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
./diagnose_access_loss.sh
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ SWAP
- OOM —Å–æ–±—ã—Ç–∏—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–∞—Ö
- –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ healthcheck
- –õ–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**2. –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
./monitor_access.sh
```

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å frontend/backend (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç proxy –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏
ssh root@93.189.228.52 'watch -n 5 docker stats'

# OOM —Å–æ–±—ã—Ç–∏—è
ssh root@93.189.228.52 'dmesg -T | grep -i "out of memory" | tail -n 10'

# –õ–æ–≥–∏ backend
ssh root@93.189.228.52 'docker logs -f backend-<container-id>'

# Healthcheck —Å—Ç–∞—Ç—É—Å
ssh root@93.189.228.52 'docker inspect --format="{{.State.Health.Status}}" backend-<container-id>'
```

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

1. **–ï—â–µ –±–æ–ª—å—à–µ —Å–Ω–∏–∑–∏—Ç—å workers:**
```yaml
GUNICORN_WORKERS: 1  # –î–ª—è –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
```

2. **–£–≤–µ–ª–∏—á–∏—Ç—å SWAP:**
```bash
./setup_swap.sh  # –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω 2GB SWAP
```

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å database pool:**
```python
# –í backend/app/db/session.py
engine = create_engine(
    DATABASE_URL,
    pool_size=5,        # –£–º–µ–Ω—å—à–∏—Ç—å —Å 10 –¥–æ 5
    max_overflow=5,     # –£–º–µ–Ω—å—à–∏—Ç—å —Å 10 –¥–æ 5
    pool_pre_ping=True,
    pool_recycle=3600,
)
```

4. **–°–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –ª–æ–∫–∞–ª—å–Ω–æ:**
```bash
# –ò–∑–±–µ–≥–∞–µ—Ç —Å–±–æ—Ä–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å)
./build_and_push.sh
```

5. **–£–≤–µ–ª–∏—á–∏—Ç—å RAM —Å–µ—Ä–≤–µ—Ä–∞:**
- –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 8GB RAM –¥–ª—è production

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è High-Traffic

–ï—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ —É–≤–µ–ª–∏—á–∏—Ç—Å—è:

```yaml
# –î–ª—è high-traffic —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º RAM
GUNICORN_WORKERS: 4
deploy:
  resources:
    limits:
      memory: 1G  # –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç
```

**–§–æ—Ä–º—É–ª–∞ –¥–ª—è workers:**
```
workers = (2 √ó CPU_cores) + 1
```

–î–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —Å 2 CPU: `(2 √ó 2) + 1 = 5 workers`

–ù–æ –ø—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—å—à–µ workers –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤).

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –î–æ–∫—É–º–µ–Ω—Ç—ã

- [MEMORY_FIX.md](MEMORY_FIX.md) - –ö—Ä–∞—Ç–∫–∞—è –ø–∞–º—è—Ç–∫–∞ –ø–æ –ø—Ä–æ–±–ª–µ–º–µ
- [docker_SETUP.md](docker_SETUP.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker
- [AUTO_PROXY_RESTART.md](AUTO_PROXY_RESTART.md) - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç proxy
- [diagnose_access_loss.sh](../diagnose_access_loss.sh) - –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
- [monitor_access.sh](../monitor_access.sh) - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –ò–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª—ã:**
1. ‚úÖ [docker-compose.prod.yml](../docker-compose.prod.yml) - –õ–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
2. ‚úÖ [backend/entrypoint.sh](../backend/entrypoint.sh) - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Gunicorn
3. ‚úÖ [diagnose_access_loss.sh](../diagnose_access_loss.sh) - –ù–æ–≤—ã–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
4. ‚úÖ [monitor_access.sh](../monitor_access.sh) - –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- Workers: 4 ‚Üí 2 (50% —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏)
- Memory limit: unlimited ‚Üí 512MB (–∑–∞—â–∏—Ç–∞ –æ—Ç OOM)
- Max requests: unlimited ‚Üí 1000 (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –†–µ—à–µ–Ω–∏—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# 1. –ü–∞–º—è—Ç—å backend —Å–Ω–∏–∑–∏–ª–∞—Å—å
ssh root@93.189.228.52 'docker stats --no-stream | grep backend'
# –û–∂–∏–¥–∞–µ—Ç—Å—è: ~400-500MB –≤–º–µ—Å—Ç–æ 826MB

# 2. –ù–µ—Ç –Ω–æ–≤—ã—Ö OOM —Å–æ–±—ã—Ç–∏–π
ssh root@93.189.228.52 'dmesg -T | grep -i "out of memory" | tail -n 5'
# –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π

# 3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ
curl -I https://budget-west.shknv.ru
curl -I https://budget-west.shknv.ru/api/v1/health
# –û–±–∞ –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å HTTP 200

# 4. Workers –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
ssh root@93.189.228.52 'docker logs backend-<id> | grep "Worker restarting"'
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –æ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –ø–æ—Å–ª–µ 1000 requests
```

**–ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 –º–∏–Ω—É—Ç** –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ!

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 06.11.2025
**–í–µ—Ä—Å–∏—è:** 0.5.1
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é
