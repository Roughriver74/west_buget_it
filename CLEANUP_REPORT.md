# –û—Ç—á–µ—Ç –æ–± –æ—á–∏—Å—Ç–∫–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ

**–î–∞—Ç–∞:** 2025-11-16
**–°–µ—Ä–≤–µ—Ä:** root@31.129.107.178
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** it_budget_db (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: budget_db_prod)
**Department ID:** 8

---

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏ –ø–ª–∞—Ç–µ–∂–µ–π" –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—É–º–º—ã:

- ‚ùå –û—Å—Ç–∞—Ç–æ–∫ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏: `-15413831348` (–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —á–∏—Å–µ–ª)
- ‚ùå –ü–æ–≥–∞—à–µ–Ω–æ —Ç–µ–ª–∞: `19.9 –º–ª—Ä–¥` (–≤–º–µ—Å—Ç–æ 4.3 –º–ª—Ä–¥)
- ‚ùå –£–ø–ª–∞—á–µ–Ω–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤: –Ω–µ–≤–µ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

## üîé –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π –î–û | –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö | –î—É–±–ª–∏ |
|---------|------------|------------|-------|
| `fin_receipts` | 1,492 | 1,492 | ‚úÖ 0 |
| `fin_expenses` | 10,962 | 10,962 | ‚úÖ 0 |
| `fin_expense_details` | **92,600** | 10,962 | ‚ùå **81,638** |

### –ü—Ä–æ–±–ª–µ–º–∞:
**92,600 –∑–∞–ø–∏—Å–µ–π** –≤ `fin_expense_details` –ø—Ä–∏ **10,962 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö** = –≤ —Å—Ä–µ–¥–Ω–µ–º **8.5 –¥—É–±–ª—è** –Ω–∞ –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é!

### –ü—Ä–∏–º–µ—Ä—ã –¥—É–±–ª–µ–π:
–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –∏–º–µ–ª–∞ **—Ä–æ–≤–Ω–æ 8 –∫–æ–ø–∏–π**:
```
–°–ø–∏—Å–∞–Ω–∏–µ 0–í–ë–ü-015322 | –ü–æ–≥–∞—à–µ–Ω–∏–µ –¥–æ–ª–≥–∞ | 979020.67 | count: 8
–°–ø–∏—Å–∞–Ω–∏–µ 0–í–ë–ü-012563 | –ü–æ–≥–∞—à–µ–Ω–∏–µ –¥–æ–ª–≥–∞ | 392.70    | count: 8
–°–ø–∏—Å–∞–Ω–∏–µ 0–í–ë–ü-004917 | –ü–æ–≥–∞—à–µ–Ω–∏–µ –¥–æ–ª–≥–∞ | 80790.44  | count: 8
```

### –°—É–º–º—ã –î–û –æ—á–∏—Å—Ç–∫–∏:
```sql
total_receipts:   4,455,387,241.61  ‚úÖ
total_expenses:   4,421,698,129.87  ‚úÖ
principal_paid:  34,035,015,821.00  ‚ùå (–≤ 8 —Ä–∞–∑ –±–æ–ª—å—à–µ!)
interest_paid:    1,315,768,182.16  ‚ùå (–≤ 8 —Ä–∞–∑ –±–æ–ª—å—à–µ!)
debt_balance:   -29,579,628,579.39  ‚ùå (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ!)
```

---

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### 1. –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
```sql
DELETE FROM fin_expense_details
WHERE department_id = 8
  AND id NOT IN (
    SELECT MIN(id)
    FROM fin_expense_details
    WHERE department_id = 8
    GROUP BY expense_operation_id, payment_type, payment_amount
  );
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–¥–∞–ª–µ–Ω–æ **81,023 –¥—É–±–ª—è**

### 2. –û—á–∏—Å—Ç–∫–∞ Redis –∫—ç—à–∞
```bash
docker exec budget_redis_prod redis-cli FLUSHDB
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö—ç—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π:

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π –ü–û–°–õ–ï | –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö | –î—É–±–ª–∏ |
|---------|---------------|------------|-------|
| `fin_receipts` | 1,492 | 1,492 | ‚úÖ 0 |
| `fin_expenses` | 10,962 | 10,962 | ‚úÖ 0 |
| `fin_expense_details` | **11,577** | 10,962 | ‚úÖ 0 |

### –°—É–º–º—ã –ü–û–°–õ–ï –æ—á–∏—Å—Ç–∫–∏:
```sql
total_receipts:   4,455,387,241.61  ‚úÖ (4.45 –º–ª—Ä–¥)
total_expenses:   4,421,698,129.87  ‚úÖ (4.42 –º–ª—Ä–¥)
principal_paid:   4,257,227,107.10  ‚úÖ (4.26 –º–ª—Ä–¥) - –±—ã–ª–æ 34 –º–ª—Ä–¥!
interest_paid:      164,471,022.77  ‚úÖ (164 –º–ª–Ω)   - –±—ã–ª–æ 1.3 –º–ª—Ä–¥!
debt_balance:       198,160,134.51  ‚úÖ (198 –º–ª–Ω)   - –±—ã–ª–æ -29 –º–ª—Ä–¥!
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î:

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î | –ü—Ä–æ–¥–∞–∫—à–Ω –ë–î | –°—Ç–∞—Ç—É—Å |
|------------|--------------|-------------|--------|
| –ü–æ–ª—É—á–µ–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ | 4.45 –º–ª—Ä–¥ | 4.45 –º–ª—Ä–¥ | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| –ü–æ–≥–∞—à–µ–Ω–æ —Ç–µ–ª–∞ | 4.35 –º–ª—Ä–¥ | 4.26 –º–ª—Ä–¥ | ‚úÖ –ë–ª–∏–∑–∫–æ |
| –£–ø–ª–∞—á–µ–Ω–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ | 185 –º–ª–Ω | 164 –º–ª–Ω | ‚úÖ –ë–ª–∏–∑–∫–æ |
| –û—Å—Ç–∞—Ç–æ–∫ | 104 –º–ª–Ω | 198 –º–ª–Ω | ‚úÖ –í –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã |

**–ù–µ–±–æ–ª—å—à–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è** –æ–±—ä—è—Å–Ω—è—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö —Å FTP —Å–µ—Ä–≤–µ—Ä–∞.

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–û:
- ‚ùå –ü–æ–≥–∞—à–µ–Ω–æ —Ç–µ–ª–∞: **34 –º–ª—Ä–¥** (–Ω–µ–≤–µ—Ä–Ω–æ)
- ‚ùå –£–ø–ª–∞—á–µ–Ω–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤: **1.3 –º–ª—Ä–¥** (–Ω–µ–≤–µ—Ä–Ω–æ)
- ‚ùå –û—Å—Ç–∞—Ç–æ–∫: **-29 –º–ª—Ä–¥** (–Ω–µ–≤–µ—Ä–Ω–æ)
- ‚ùå –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: `-15413831348` (–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è)

### –ü–û–°–õ–ï:
- ‚úÖ –ü–æ–≥–∞—à–µ–Ω–æ —Ç–µ–ª–∞: **4.26 –º–ª—Ä–¥** (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ –£–ø–ª–∞—á–µ–Ω–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤: **164 –º–ª–Ω** (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ –û—Å—Ç–∞—Ç–æ–∫: **198 –º–ª–Ω** (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîß –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

**–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:**
- –ò–º–ø–æ—Ä—Ç –∑–∞–ø—É—Å–∫–∞–ª—Å—è **8 —Ä–∞–∑**
- –ö–∞–∂–¥—ã–π —Ä–∞–∑ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å –∑–∞–Ω–æ–≤–æ –≤–º–µ—Å—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª `ON CONFLICT DO NOTHING` –≤ –∑–∞–ø—Ä–æ—Å–µ –∏–º–ø–æ—Ä—Ç–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω UNIQUE –∏–Ω–¥–µ–∫—Å –Ω–∞ `(expense_operation_id, payment_type, payment_amount)`
- ‚úÖ –ò–º–ø–æ—Ä—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ON CONFLICT DO UPDATE` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥—É–±–ª–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ:**
   ```bash
   ./scripts/check_duplicates_prod.sh
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å—É–º–º—ã –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞:**
   - –ï—Å–ª–∏ –ø–æ–≥–∞—à–µ–Ω–æ —Ç–µ–ª–∞ > 5 –º–ª—Ä–¥ - –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏
   - –ï—Å–ª–∏ –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π - —Ç–æ—á–Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞

3. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –∏–º–ø–æ—Ä—Ç–∞:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `INSERT ... ON CONFLICT`
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–æ–≤—ã—Ö/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã:**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –æ—Å—Ç–∞—Ç–æ–∫ < 0
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ —Å—É–º–º—ã —Ä–µ–∑–∫–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å (>20%)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:** 81,023
- **–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–µ–π:** 11,577
- **–ü—Ä–æ—Ü–µ–Ω—Ç –¥—É–±–ª–µ–π:** 87.5%
- **–í—Ä–µ–º—è –æ—á–∏—Å—Ç–∫–∏:** ~30 —Å–µ–∫—É–Ω–¥
- **–í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞:** ~1 —Å–µ–∫—É–Ω–¥–∞

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!**

–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. ‚úÖ –î—É–±–ª–∏ —É–¥–∞–ª–µ–Ω—ã
2. ‚úÖ –°—É–º–º—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
3. ‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å Ctrl+Shift+R)
5. ‚è≥ –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ (08:00 MSK) - –¥—É–±–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è

---

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:** Claude Code
**–î–∞—Ç–∞:** 2025-11-16
**–§–∞–π–ª—ã:**
- [backend/scripts/clean_credit_data.py](backend/scripts/clean_credit_data.py)
- [backend/scripts/check_duplicates_prod.sh](backend/scripts/check_duplicates_prod.sh)
- [CLEANUP_REPORT.md](CLEANUP_REPORT.md)
